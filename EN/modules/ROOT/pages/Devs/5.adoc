:sectnums:
:sectnumlevels: 5

:imagesdir: ./_images

= Compatible oracle-sequence

== Objective

- In order to be compatible with Oracle-Sequence, it is necessary to improve the functionality of Postgres on the basis of the original SEQ to achieve the goal.

== Feature implementation

=== Create sequence

- Including direct create sequence and create table fields with sequence attributes, the flowchart is as follows:

image::p11.png[]

- Due to the differences between Oracle and PG SEQ, 3 features of the ORA SEQ have been added to the AttIdentity field in the pg_attri table:
```
i: Represents the generated always option compatible with Oracle
o: Represents the generated by default option compatible with Oracle
n: Represents Oracle-compatible default on null option
```

=== Alter sequence 

- Includes direct alter sequence and alter table with sequence attribute fields. The process is similar to the Create Sequence.


=== Update/insert

- For sequence fields in the insert and update tables, some restrictions need to be made. As well as some of the attribute transformations that Oracle needs, the flowchart is as follows:

image::p12.png[]

=== Pg_dump

- During the data export process, the SQL that creates the table is generated, and the value of the attidentity field in the pg_attri table needs to be determined to generate an SQL statement that creates orq seq

== Test cases

```
create sequence test1
nomaxvalue
nominvalue
nocycle
cache 20
noorder
;
```

```
postgres=# alter sequence test1
maxvalue 9999
minvalue 1
cycle
cache 2
order;
```

```
dorp sequence test1;
```

```
create table t2 
(id int GENERATED BY DEFAULT AS IDENTITY start with 1,
 id2 int
 );

```












